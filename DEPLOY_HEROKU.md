# Инструкция по развертыванию Telegram-бота на Heroku

Этот документ поможет вам развернуть вашего Telegram-бота на платформе Heroku. Heroku лучше подходит для данного бота, чем Vercel, так как позволяет запускать постоянно работающие процессы (`worker`).

## ⚠️ Важные ограничения

1.  **Эфемерная файловая система:** Heroku, как и Vercel, использует временное файловое хранилище. Это означает, что ваша локальная база данных **SQLite (`kredo-bet-bot.db`) не будет работать**. Она будет стираться как минимум раз в 24 часа при перезапуске "дино" и при каждом новом развертывании.
    *   **Решение:** Вам необходимо использовать облачную базу данных. Heroku предлагает бесплатный план **Heroku Postgres**. Это настоятельно рекомендуемый вариант. Вам потребуется изменить код в `src/services/database.js` для подключения к Postgres вместо SQLite.

2.  **Состояние диалога в памяти:** Текущая реализация хранит состояние диалога в памяти (`conversationState`). Это будет работать, пока вы используете один `worker` дино. Если вы решите масштабировать приложение до нескольких дино, вы столкнетесь с проблемой рассинхронизации состояния. Для бесплатного тарифа это не является проблемой.

---

## Шаги по развертыванию

### Шаг 1: Подготовка

1.  **Аккаунт Heroku:** Убедитесь, что у вас есть аккаунт на [Heroku](https://www.heroku.com/).
2.  **Heroku CLI:** Установите Heroku Command Line Interface (CLI), следуя [официальной инструкции](https://devcenter.heroku.com/articles/heroku-cli).
3.  **Код в репозитории:** Загрузите код вашего проекта в Git-репозиторий.

### Шаг 2: Создание и настройка приложения Heroku

1.  **Войдите в Heroku через CLI:**
    ```bash
    heroku login
    ```

2.  **Создайте новое приложение Heroku:**
    (Замените `your-unique-app-name` на уникальное имя вашего приложения)
    ```bash
    heroku create your-unique-app-name
    ```

3.  **Добавьте билдпак для Puppeteer:** Это **критически важный** шаг. Этот билдпак установит Google Chrome и все необходимые зависимости в окружение Heroku.
    ```bash
    heroku buildpacks:add --index 1 https://github.com/jontewks/puppeteer-heroku-buildpack
    ```
    *Также добавьте стандартный билдпак для Node.js, если он не добавился автоматически.*
    ```bash
    heroku buildpacks:add heroku/nodejs
    ```

4.  **Настройте переменные окружения:**
    (Замените `<ВАШ_ТОКЕН>` на реальный токен вашего бота)
    ```bash
    heroku config:set TELEGRAM_BOT_TOKEN=<ВАШ_ТОКЕН>
    ```
    *Добавьте сюда все остальные секреты из вашего `.env` файла.*

### Шаг 3: Настройка базы данных (Рекомендуется)

1.  **Добавьте аддон Heroku Postgres:**
    ```bash
    heroku addons:create heroku-postgresql:hobby-dev
    ```
    `hobby-dev` — это бесплатный тариф.

2.  **Получите URL для подключения:** Heroku автоматически добавит переменную окружения `DATABASE_URL`. Вы можете посмотреть ее значение командой:
    ```bash
    heroku config:get DATABASE_URL
    ```

3.  **Обновите код:** Вам нужно будет установить драйвер для Postgres (`npm install pg`) и изменить логику в `src/services/database.js` для использования `DATABASE_URL` и работы с Postgres.

### Шаг 4: Развертывание кода

1.  **Отправьте код на Heroku:**
    ```bash
    git push heroku main 
    ```
    (Или `master`, в зависимости от названия вашей основной ветки)

2.  **Запустите worker:** После развертывания Heroku запустит процессы, описанные в `Procfile`. В нашем случае это `worker`. Убедитесь, что он активен:
    ```bash
    heroku ps:scale worker=1
    ```
    Эта команда указывает Heroku запустить 1 экземпляр вашего worker'а.

### Шаг 5: Проверка логов

Для отслеживания работы бота и поиска ошибок используйте команду:
```bash
heroku logs --tail
```

После выполнения этих шагов ваш бот будет развернут и запущен на Heroku.
