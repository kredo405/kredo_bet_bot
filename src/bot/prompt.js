const { getPrediction } = require('../services/llm');
const { oddsData } = require('../services/database');
const helpers = require('./helpers'); // Import the entire helpers module

async function generateFinalPrompt(promptType, state, fbrefH2hData) {
    console.log("--- State received in prompt.js ---", JSON.stringify(state, null, 2));
    const { match, rawOddsHistory, weather, processedFacts, statshubHomePerformance, statshubAwayPerformance, statshubMatchInfo, sofascoreLineups, processedHomePlayers, processedAwayPlayers, sofascorePregameForm, poissonProbabilities, poissonScoreProbabilities, expertOpinion, homePerformanceAnalysis, awayPerformanceAnalysis, homeTeamFbrefStats, awayTeamFbrefStats } = state;
    
    const structuredOdds = helpers.formatOddsHistory(rawOddsHistory, oddsData);
    let oddsHistoryText = '';

    if (structuredOdds.length > 0) {
        try {
            const oddsPrompt = `
–¢—ã ‚Äî –∞–Ω–∞–ª–∏—Ç–∏–∫ –±—É–∫–º–µ–∫–µ—Ä—Å–∫–æ–≥–æ —Ä—ã–Ω–∫–∞. –¢–µ–±–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω—ã —Å—ã—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ –æ –¥–≤–∏–∂–µ–Ω–∏–∏ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–≤.
–¢–≤–æ—è –∑–∞–¥–∞—á–∞ ‚Äî –ø—Ä–µ–≤—Ä–∞—Ç–∏—Ç—å –∏—Ö –≤ –∫—Ä–∞—Ç–∫–∏–π, –Ω–æ –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–π —Å–ø–∏—Å–æ–∫ —Ä—ã–Ω–æ—á–Ω—ã—Ö —Å–∏–≥–Ω–∞–ª–æ–≤ –¥–ª—è –∫–∞–ø–ø–µ—Ä–∞. –ï—Å–ª–∏ –ø—Ä–æ–≥—Ä—É–∑ –Ω–µ –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω—ã–π(–º–µ–Ω—å—à–µ 5% —É–±–∏—Ä–∞–π –∏—Å—Ö–æ–¥ –∏—Ö –æ—Ç–≤–µ—Ç–∞). –ï—Å–ª–∏ –ø—Ä–æ–≥—Ä—É–∑–æ–≤ –Ω–µ—Ç –æ—Ç–≤–µ—Ç—å —á—Ç–æ –ø—Ä–æ–≥—Ä—É–∑–æ–≤ –Ω–µ—Ç.

–í–æ—Ç –¥–∞–Ω–Ω—ã–µ:
\`\`\`json
${JSON.stringify(structuredOdds, null, 2)}
\`\`\`

–ü—Ä–∞–≤–∏–ª–∞ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤—ã–≤–æ–¥–∞:
1.  –û—Ç–≤–µ—Ç –¥–æ–ª–∂–µ–Ω –Ω–∞—á–∏–Ω–∞—Ç—å—Å—è —Å –∑–∞–≥–æ–ª–æ–≤–∫–∞: "–î–í–ò–ñ–ï–ù–ò–ï –ö–û–≠–§–§–ò–¶–ò–ï–ù–¢–û–í (–°–ò–ì–ù–ê–õ–´) [–í–µ—Å: –û—á–µ–Ω—å –≤—ã—Å–æ–∫–∏–π]:".
2.  –ö–∞–∂–¥—ã–π –∏—Å—Ö–æ–¥ ‚Äî —ç—Ç–æ –æ—Ç–¥–µ–ª—å–Ω—ã–π –ø—É–Ω–∫—Ç —Å–ø–∏—Å–∫–∞.
3.  –î–ª—è –∫–∞–∂–¥–æ–≥–æ –ø—É–Ω–∫—Ç–∞ —É–∫–∞–∂–∏ –∏—Å—Ö–æ–¥, –∏–∑–º–µ–Ω–µ–Ω–∏–µ –∫—ç—Ñ–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, "1.90 -> 1.75") –∏ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –≤ –ø—Ä–æ—Ü–µ–Ω—Ç–∞—Ö.
4.  –ï—Å–ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–µ > 10% (isSignificant: true), –ø–æ–º–µ—Ç—å –µ–≥–æ –∫–∞–∫ "‚ùóÔ∏è –ü—Ä–æ–≥—Ä—É–∑".
5.  –ï—Å–ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–µ < -10% (isSignificant: true), –ø–æ–º–µ—Ç—å –µ–≥–æ –∫–∞–∫ "üìà –†–æ—Å—Ç –ª–∏–Ω–∏–∏".
6.  –°—Ç–∏–ª—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ª–∞–∫–æ–Ω–∏—á–Ω—ã–º –∏ "—Å–∏–≥–Ω–∞–ª—å–Ω—ã–º".

–ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞:
–î–í–ò–ñ–ï–ù–ò–ï –ö–û–≠–§–§–ò–¶–ò–ï–ù–¢–û–í (–°–ò–ì–ù–ê–õ–´) [–í–µ—Å: –û—á–µ–Ω—å –≤—ã—Å–æ–∫–∏–π]:
- –û–ó –î–∞: 1.80 -> 1.65 (–ü–∞–¥–µ–Ω–∏–µ -8%)
- –¢–ë 2.5: 2.10 -> 1.85 (–ü–∞–¥–µ–Ω–∏–µ -12%) ‚ùóÔ∏è –ü—Ä–æ–≥—Ä—É–∑
- –ü2: 3.50 -> 4.10 (–†–æ—Å—Ç +17%) üìà –†–æ—Å—Ç –ª–∏–Ω–∏–∏
`;
            oddsHistoryText = await getPrediction(oddsPrompt);
        } catch (e) {
            console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ AI-—Å–∏–≥–Ω–∞–ª–æ–≤ –ø–æ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–∞–º:", e);
            oddsHistoryText = '–î–í–ò–ñ–ï–ù–ò–ï –ö–û–≠–§–§–ò–¶–ò–ï–ù–¢–û–í [–í–µ—Å: –û—á–µ–Ω—å –≤—ã—Å–æ–∫–∏–π]:\n–ù–µ —É–¥–∞–ª–æ—Å—å —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å AI-–∞–Ω–∞–ª–∏–∑.\n';
        }
    }

    let weatherText = '';
    if (weather && weather.temp !== undefined && weather.condition) {
        weatherText = `–ü–û–ì–û–î–ê: –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞: ${weather.temp}, –£—Å–ª–æ–≤–∏—è: ${weather.condition}\n\n`;
    }

    let factsText = '';
    if (processedFacts && processedFacts.length > 0) {
        factsText = `–ò–ù–¢–ï–†–ï–°–ù–´–ï –§–ê–ö–¢–´ [–í–µ—Å: —Å—Ä–µ–¥–Ω–∏–π]:\n${processedFacts}\n\n`;
    }

    let sofascoreFormText = '';
    if (sofascorePregameForm) {
        sofascoreFormText = '–§–û–†–ú–ê –ö–û–ú–ê–ù–î (SOFASCORE) [–í–µ—Å: –°—Ä–µ–¥–Ω–∏–π]:\n';
        if (sofascorePregameForm.homeTeam) {
            const { position, value, form } = sofascorePregameForm.homeTeam;
            sofascoreFormText += `- –î–æ–º–∞—à–Ω—è—è –∫–æ–º–∞–Ω–¥–∞: –ü–æ–∑–∏—Ü–∏—è: ${position}, –û—á–∫–∏: ${value}, –§–æ—Ä–º–∞: ${form.join(', ')}\n`;
        }
        if (sofascorePregameForm.awayTeam) {
            const { position, value, form } = sofascorePregameForm.awayTeam;
            sofascoreFormText += `- –ì–æ—Å—Ç–µ–≤–∞—è –∫–æ–º–∞–Ω–¥–∞: –ü–æ–∑–∏—Ü–∏—è: ${position}, –û—á–∫–∏: ${value}, –§–æ—Ä–º–∞: ${form.join(', ')}\n`;
        }
        sofascoreFormText += '\n';
    }

    let h2hText = '–ò–°–¢–û–†–ò–Ø –õ–ò–ß–ù–´–• –í–°–¢–†–ï–ß (H2H) [–í–µ—Å: –°—Ä–µ–¥–Ω–∏–π:\n';
    if (fbrefH2hData && fbrefH2hData.length > 0) {
        h2hText += fbrefH2hData.map(match => `- ${match.homeTeam} ${match.score} ${match.awayTeam} (xG: ${match.homeXG || 'N/A'}-${match.awayXG || 'N/A'}) (${match.competition}, ${match.date})`).join('\n');
    } else {
        h2hText += '–õ–∏—á–Ω—ã—Ö –≤—Å—Ç—Ä–µ—á –Ω–µ –Ω–∞–π–¥–µ–Ω–æ.';
    }
    h2hText += '\n\n';

    let poissonScoreProbabilitiesText = '';
    if (poissonScoreProbabilities && Object.keys(poissonScoreProbabilities).length > 0) {
        poissonScoreProbabilitiesText = '–í–ï–†–û–Ø–¢–ù–û–°–¢–ò –¢–û–ß–ù–û–ì–û –°–ß–ï–¢–ê (–ú–û–î–ï–õ–¨ –ü–£–ê–°–°–û–ù–ê) [–í–µ—Å: –°—Ä–µ–¥–Ω–∏–π]:\n';
        
        const sortedScores = Object.entries(poissonScoreProbabilities)
            .filter(([, prob]) => prob > 0.1)
            .sort(([, a], [, b]) => b - a);

        for (const [score, prob] of sortedScores) {
            poissonScoreProbabilitiesText += `- ${score}: ${prob.toFixed(2)}%\n`;
        }
        poissonScoreProbabilitiesText += '\n';
    }

    let expertOpinionText = '';
    if (expertOpinion) {
        expertOpinionText = `–û–ë–©–ï–ï –ú–ù–ï–ù–ò–ï –≠–ö–°–ü–ï–†–¢–û–í (PERPLEXITY) [–í–µ—Å: –í—ã—Å–æ–∫–∏–π]:\n${expertOpinion}\n\n`;
    }

    let performanceAnalysisText = '';
    if (homePerformanceAnalysis || awayPerformanceAnalysis) {
        performanceAnalysisText = 'AI-–ê–ù–ê–õ–ò–ó –ò–ì–†–û–í–û–ô –§–û–†–ú–´ [–í–µ—Å: –í—ã—Å–æ–∫–∏–π]:\n';
        if (homePerformanceAnalysis) {
            performanceAnalysisText += `–î–æ–º–∞—à–Ω—è—è –∫–æ–º–∞–Ω–¥–∞ (${statshubMatchInfo?.homeTeam?.name}): ${homePerformanceAnalysis}\n`;
        }
        if (awayPerformanceAnalysis) {
            performanceAnalysisText += `–ì–æ—Å—Ç–µ–≤–∞—è –∫–æ–º–∞–Ω–¥–∞ (${statshubMatchInfo?.awayTeam?.name}): ${awayPerformanceAnalysis}\n`;
        }
        performanceAnalysisText += '\n';
    }

    const formatStatshubPerformance = (teamName, performanceData) => {
        if (!performanceData || performanceData.length === 0 || !teamName) return '';

        const numMatches = performanceData.length;

        // A list of all keys we want to aggregate
        const statKeys = [
            "expectedGoals", "bigChanceCreated", "bigChanceScored", "bigChanceMissed",
            "totalShotsInsideBox", "totalShotsOutsideBox", "touchesInOppBox", "finalThirdEntries",
            "ballPossession", "pass_accuracy",
            "goalsPrevented", "aerialDuelsPercentage", "duelWonPercent", "interceptionWon", "totalTackle", "wonTacklePercent",
            "errorsLeadToGoal"
        ];

        // Initialize accumulator for own and opponent stats
        const totals = { own: {}, opponent: {} };
        statKeys.forEach(key => {
            totals.own[key] = { total: 0, count: 0 };
            totals.opponent[key] = { total: 0, count: 0 };
        });
        totals.own.goalsScored = 0; // Special case for actual goals

        // Loop through matches and accumulate stats
        performanceData.forEach(match => {
            if (match.homeTeam === teamName) totals.own.goalsScored += match.scoreHome;
            else if (match.awayTeam === teamName) totals.own.goalsScored += match.scoreAway;

            statKeys.forEach(key => {
                // Own stats
                if (match.statistics && typeof match.statistics[key] === 'number') {
                    totals.own[key].total += match.statistics[key];
                    totals.own[key].count++;
                }
                // Opponent stats
                if (match.opponentStatistics && typeof match.opponentStatistics[key] === 'number') {
                    totals.opponent[key].total += match.opponentStatistics[key];
                    totals.opponent[key].count++;
                }
            });
        });
        
        // Helper to calculate average safely
        const avg = (stat) => {
            if (!stat || stat.count === 0) return 'N/A';
            return (stat.total / stat.count).toFixed(2);
        };

        // Neutral, data-driven interpretations
        const totalXG = totals.own.expectedGoals.total;
        const xgPerformanceDiff = totals.own.goalsScored - totalXG;
        let realizationInterpretation = "";
        if (xgPerformanceDiff > 0.1) {
            realizationInterpretation = `Overperforming (+${xgPerformanceDiff.toFixed(2)} –≥–æ–ª–∞ –∑–∞ ${numMatches} –º–∞—Ç—á–µ–π)`;
        } else if (xgPerformanceDiff < -0.1) {
            realizationInterpretation = `Underperforming (${xgPerformanceDiff.toFixed(2)} –≥–æ–ª–∞ –∑–∞ ${numMatches} –º–∞—Ç—á–µ–π)`;
        } else {
            realizationInterpretation = `(–†–µ–∞–ª–∏–∑–∞—Ü–∏—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç xG)`;
        }

        let text = `–°–¢–ê–¢–ò–°–¢–ò–ö–ê –ü–†–û–ò–ó–í–û–î–ò–¢–ï–õ–¨–ù–û–°–¢–ò –ö–û–ú–ê–ù–î–´ ${teamName.toUpperCase()} (–°–í–û–î–ö–ê –ó–ê ${numMatches} –ú–ê–¢–ß–ï–ô) [–í–µ—Å: –≤—ã—Å–æ–∫–∏–π]:\n\n`;
        
        text += `  –°–í–û–Ø –°–¢–ê–¢–ò–°–¢–ò–ö–ê (–≤ —Å—Ä–µ–¥–Ω–µ–º –∑–∞ –º–∞—Ç—á):\n`;
        text += `    - –ê—Ç–∞–∫–∞: xG: ${avg(totals.own.expectedGoals)}, –†–µ–∞–ª–∏–∑–∞—Ü–∏—è: ${realizationInterpretation}, –£–ø—É—â–µ–Ω–æ –±–æ–ª—å—à–∏—Ö —à–∞–Ω—Å–æ–≤: ${avg(totals.own.bigChanceMissed)}, –°–æ–∑–¥–∞–Ω–æ –±–æ–ª—å—à–∏—Ö —à–∞–Ω—Å–æ–≤: ${avg(totals.own.bigChanceCreated)}\n`;
        text += `    - –£–¥–∞—Ä—ã (–≤ —à—Ç—Ä–∞—Ñ–Ω–æ–π/–≤–Ω–µ): ${avg(totals.own.totalShotsInsideBox)}/${avg(totals.own.totalShotsOutsideBox)}, –ö–∞—Å–∞–Ω–∏—è –≤ —à—Ç—Ä–∞—Ñ–Ω–æ–π: ${avg(totals.own.touchesInOppBox)}, –í—Ö–æ–¥—ã –≤ —Ñ–∏–Ω–∞–ª—å–Ω—É—é —Ç—Ä–µ—Ç—å: ${avg(totals.own.finalThirdEntries)}\n`;
        text += `    - –í–ª–∞–¥–µ–Ω–∏–µ –∏ –ø–∞—Å—ã: –í–ª–∞–¥–µ–Ω–∏–µ: ${avg(totals.own.ballPossession)}%, –¢–æ—á–Ω–æ—Å—Ç—å –ø–∞—Å–æ–≤: ${avg(totals.own.pass_accuracy)}%\n`;
        text += `    - –û–±–æ—Ä–æ–Ω–∞: –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–æ –≥–æ–ª–æ–≤ (xG conceded - goals): ${avg(totals.own.goalsPrevented)}, –í—ã–∏–≥—Ä–∞–Ω–æ –¥—É—ç–ª–µ–π: ${avg(totals.own.duelWonPercent)}%, –ü–µ—Ä–µ—Ö–≤–∞—Ç—ã: ${avg(totals.own.interceptionWon)}, –û—Ç–±–æ—Ä—ã: ${avg(totals.own.totalTackle)}\n`;
        text += `    - –û—à–∏–±–∫–∏, –ø—Ä–∏–≤–µ–¥—à–∏–µ –∫ –≥–æ–ª—É: ${avg(totals.own.errorsLeadToGoal)}\n\n`;

        text += `  –°–¢–ê–¢–ò–°–¢–ò–ö–ê –°–û–ü–ï–†–ù–ò–ö–û–í (–≤ —Å—Ä–µ–¥–Ω–µ–º –∑–∞ –º–∞—Ç—á):\n`;
        text += `    - –ê—Ç–∞–∫–∞: xG: ${avg(totals.opponent.expectedGoals)}, –°–æ–∑–¥–∞–Ω–æ –±–æ–ª—å—à–∏—Ö —à–∞–Ω—Å–æ–≤: ${avg(totals.opponent.bigChanceCreated)}, –£–ø—É—â–µ–Ω–æ –±–æ–ª—å—à–∏—Ö —à–∞–Ω—Å–æ–≤: ${avg(totals.opponent.bigChanceMissed)}\n`;
        text += `    - –£–¥–∞—Ä—ã (–≤ —à—Ç—Ä–∞—Ñ–Ω–æ–π/–≤–Ω–µ): ${avg(totals.opponent.totalShotsInsideBox)}/${avg(totals.opponent.totalShotsOutsideBox)}, –ö–∞—Å–∞–Ω–∏—è –≤ —à—Ç—Ä–∞—Ñ–Ω–æ–π: ${avg(totals.opponent.touchesInOppBox)}, –í—Ö–æ–¥—ã –≤ —Ñ–∏–Ω–∞–ª—å–Ω—É—é —Ç—Ä–µ—Ç—å: ${avg(totals.opponent.finalThirdEntries)}\n`;
        text += `    - –í–ª–∞–¥–µ–Ω–∏–µ –∏ –ø–∞—Å—ã: –í–ª–∞–¥–µ–Ω–∏–µ: ${avg(totals.opponent.ballPossession)}%, –¢–æ—á–Ω–æ—Å—Ç—å –ø–∞—Å–æ–≤: ${avg(totals.opponent.pass_accuracy)}%\n`;
        text += `    - –û–±–æ—Ä–æ–Ω–∞: –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–æ –≥–æ–ª–æ–≤: ${avg(totals.opponent.goalsPrevented)}, –í—ã–∏–≥—Ä–∞–Ω–æ –¥—É—ç–ª–µ–π: ${avg(totals.opponent.duelWonPercent)}%, –ü–µ—Ä–µ—Ö–≤–∞—Ç—ã: ${avg(totals.opponent.interceptionWon)}, –û—Ç–±–æ—Ä—ã: ${avg(totals.opponent.totalTackle)}\n`;
        text += `    - –û—à–∏–±–∫–∏, –ø—Ä–∏–≤–µ–¥—à–∏–µ –∫ –≥–æ–ª—É: ${avg(totals.opponent.errorsLeadToGoal)}\n\n`;
        
        return text;
    };

    const formatFbrefTeamStats = (teamName, fbrefStats) => {
        if (!fbrefStats || fbrefStats.error) return '';
        let text = `–†–ê–°–®–ò–†–ï–ù–ù–ê–Ø –°–¢–ê–¢–ò–°–¢–ò–ö–ê FBREF –î–õ–Ø ${teamName.toUpperCase()} [–í–µ—Å: –í—ã—Å–æ–∫–∏–π]:\n\n`;

        // Home/Away results
        if (fbrefStats.results) {
            text += `  –†–ï–ó–£–õ–¨–¢–ê–¢–´ –î–û–ú–ê/–í –ì–û–°–¢–Ø–•:\n`;
            text += `    - –î–æ–º–∞: (–ü–æ–±–µ–¥-–Ω–∏—á—å–∏—Ö-–ø–æ—Ä–∞–∂–µ–Ω–∏–π) ${fbrefStats.results.home_wins || 0}-${fbrefStats.results.home_ties || 0}-${fbrefStats.results.home_losses || 0} (xG/xGA: ${fbrefStats.results.home_xg_for || 'N/A'}/${fbrefStats.results.home_xg_against || 'N/A'})\n`;
            text += `    - –í –≥–æ—Å—Ç—è—Ö: (–ü–æ–±–µ–¥-–Ω–∏—á—å–∏—Ö-–ø–æ—Ä–∞–∂–µ–Ω–∏–π) ${fbrefStats.results.away_wins || 0}-${fbrefStats.results.away_ties || 0}-${fbrefStats.results.away_losses || 0} (xG/xGA: ${fbrefStats.results.away_xg_for || 'N/A'}/${fbrefStats.results.away_xg_against || 'N/A'})\n\n`;
        }

        // Recent Match Logs
        if (fbrefStats.matchlogs && fbrefStats.matchlogs.length > 0) {
            text += `  –ü–û–°–õ–ï–î–ù–ò–ï 5 –ú–ê–¢–ß–ï–ô:\n`;
            console.log( fbrefStats.matchlogs)
            fbrefStats.matchlogs.forEach(m => {
                text += `    - ${m.date}: —Ä–µ–∑—É–ª—å—Ç–∞—Ç: ${m.result}, –ø—Ä–æ—Ç–∏–≤ ${m.opponent}, –ó–∞–±–∏–ª–∏: ${m.goals_for}, –ü—Ä–æ–ø—É—Å—Ç–∏–ª–∏: ${m.goals_against},  (${m.comp}), (xG_for/xg_against: ${m.xg_for}/${m.xg_against}, –í–ª–∞–¥–µ–Ω–∏–µ: ${m.possession}%)\n`;
            });
            text += '\n';
        }
        
        // Top Players
        if (fbrefStats.player_stats && fbrefStats.player_stats.length > 0) {
            text += `  –ö–õ–Æ–ß–ï–í–´–ï –ü–û–õ–ï–í–´–ï –ò–ì–†–û–ö–ò (–ø–æ –ø–æ–∫–∞–∑–∞—Ç–µ–ª—è–º):\n`;
            
            const playerStats = fbrefStats.player_stats;
            const keyMetrics = ['xg_per90', 'xg_assist_per90', 'sca_per90', 'gca_per90'];
            const topPlayers = new Map();

            keyMetrics.forEach(metric => {
                // Sort players by the current metric, parsing numbers for correct sorting
                const sortedPlayers = [...playerStats]
                    .filter(p => p[metric] && parseFloat(p[metric]) > 0)
                    .sort((a, b) => parseFloat(b[metric]) - parseFloat(a[metric]));
                
                // Get top 3 for the metric
                const topForMetric = sortedPlayers.slice(0, 3);

                // Add them to the map
                topForMetric.forEach(player => {
                    if (!topPlayers.has(player.player)) {
                        topPlayers.set(player.player, { player, metrics: [] });
                    }
                    topPlayers.get(player.player).metrics.push(metric);
                });
            });

            if (topPlayers.size === 0) {
                 text += '    –ù–µ –Ω–∞–π–¥–µ–Ω–æ –≤—ã–¥–∞—é—â–∏—Ö—Å—è –∏–≥—Ä–æ–∫–æ–≤ –ø–æ –∫–ª—é—á–µ–≤—ã–º –º–µ—Ç—Ä–∏–∫–∞–º.\n';
            } else {
                topPlayers.forEach(({ player, metrics }) => {
                    text += `    - ${player.player} (${player.position}): –¢–æ–ø-3 –ø–æ: ${metrics.join(', ')} (xG/90: ${player.xg_per90}, xA/90: ${player.xg_assist_per90}, SCA/90: ${player.sca_per90}, GCA/90: ${player.gca_per90})\n`;
                });
            }
            text += '\n';
        }

        // Goalkeeper stats
        if (fbrefStats.goalkeeper_stats && fbrefStats.goalkeeper_stats.length > 0) {
            text += `  –°–¢–ê–¢–ò–°–¢–ò–ö–ê –í–†–ê–¢–ê–†–ï–ô:\n`;
            fbrefStats.goalkeeper_stats.slice(0, 2).forEach(gk => {
                text += `    - ${gk.player}: PSxG+/-: ${gk.gk_psxg_net_per90}\n`;
            });
            text += '\n';
        }
        return text;
    };

    const homeTeamName = statshubMatchInfo?.homeTeam?.name;
    const awayTeamName = statshubMatchInfo?.awayTeam?.name;
    const statshubHomePerformanceText = formatStatshubPerformance(homeTeamName, statshubHomePerformance);
    const statshubAwayPerformanceText = formatStatshubPerformance(awayTeamName, statshubAwayPerformance);
    const fbrefHomeStatsText = formatFbrefTeamStats(homeTeamName, homeTeamFbrefStats);
    const fbrefAwayStatsText = formatFbrefTeamStats(awayTeamName, awayTeamFbrefStats);

    
    // --- AI-POWERED PLAYER DATA COMBINATION ---
    let combinedPlayerText = '–ö–õ–Æ–ß–ï–í–´–ï –í–´–í–û–î–´ –ü–û –°–û–°–¢–ê–í–ê–ú [–í–µ—Å: –í—ã—Å–æ–∫–∏–π]:\n\n–ù–µ —É–¥–∞–ª–æ—Å—å –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –ø–æ –∏–≥—Ä–æ–∫–∞–º.\n\n'; // Default text in case of error
    try {
        const playerDataPrompt = `
# –ó–ê–î–ê–ß–ê
–¢—ã ‚Äî —ç–ª–∏—Ç–Ω—ã–π —Å–ø–æ—Ä—Ç–∏–≤–Ω—ã–π –∞–Ω–∞–ª–∏—Ç–∏–∫. –¢–≤–æ—è –∑–∞–¥–∞—á–∞ ‚Äî –≥–ª—É–±–æ–∫–æ –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –ø–æ —Å–æ—Å—Ç–∞–≤–∞–º –∫–æ–º–∞–Ω–¥ (–æ—Å–Ω–æ–≤–Ω—ã–µ –∏–≥—Ä–æ–∫–∏, –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ) –∏ –∏—Ö –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É, –∞ –∑–∞—Ç–µ–º —Å—Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∞—Ç—å **–∫—Ä–∞—Ç–∫–∏–µ, –Ω–æ –µ–º–∫–∏–µ –≤—ã–≤–æ–¥—ã**, –∫–æ—Ç–æ—Ä—ã–µ –Ω–∞–ø—Ä—è–º—É—é –≤–ª–∏—è—é—Ç –Ω–∞ –ø—Ä–æ–≥–Ω–æ–∑ –º–∞—Ç—á–∞. –ù–µ –Ω—É–∂–Ω–æ –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –≤—Å—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É, —Ç–æ–ª—å–∫–æ –∫–ª—é—á–µ–≤—ã–µ –∏–Ω—Å–∞–π—Ç—ã.

# –í–•–û–î–ù–´–ï –î–ê–ù–ù–´–ï

## 1. –°–æ—Å—Ç–∞–≤—ã Sofascore (lineups)
\`\`\`json
${JSON.stringify(sofascoreLineups, null, 2)}
\`\`\`

## 2. –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –¥–æ–º–∞—à–Ω–µ–π –∫–æ–º–∞–Ω–¥—ã (Statshub)
\`\`\`json
${JSON.stringify(processedHomePlayers, null, 2)}
\`\`\`

## 3. –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≥–æ—Å—Ç–µ–≤–æ–π –∫–æ–º–∞–Ω–¥—ã (Statshub)
\`\`\`json
${JSON.stringify(processedAwayPlayers, null, 2)}
\`\`\`

# –ê–õ–ì–û–†–ò–¢–ú –ê–ù–ê–õ–ò–ó–ê
1.  **–°–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –∏–≥—Ä–æ–∫–æ–≤:** –ú—ã—Å–ª–µ–Ω–Ω–æ —Å–æ–ø–æ—Å—Ç–∞–≤—å –∏–≥—Ä–æ–∫–æ–≤ –º–µ–∂–¥—É JSON-–æ–±—ä–µ–∫—Ç–∞–º–∏, –∏—Å–ø–æ–ª—å–∑—É—è –Ω–µ—á–µ—Ç–∫–æ–µ —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –∏–º–µ–Ω (–Ω–∞–ø—Ä–∏–º–µ—Ä, "K. De Bruyne" –∏ "Kevin De Bruyne" ‚Äî –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ —á–µ–ª–æ–≤–µ–∫).
2.  **–ê–Ω–∞–ª–∏–∑ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏—Ö:** –ò–∑—É—á–∏ —Å–µ–∫—Ü–∏—é 'missingPlayers' –¥–ª—è –∫–∞–∂–¥–æ–π –∫–æ–º–∞–Ω–¥—ã.
    - –û–ø—Ä–µ–¥–µ–ª–∏ **—Å–∞–º—ã—Ö –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö** –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏—Ö, –æ—Å–Ω–æ–≤—ã–≤–∞—è—Å—å –Ω–∞ –∏—Ö —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–µ (–æ—Å–æ–±–µ–Ω–Ω–æ xG, xA, —Ä–µ–π—Ç–∏–Ω–≥), –ø–æ–∑–∏—Ü–∏–∏ –∏ —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä–Ω–æ–π —Å—Ç–æ–∏–º–æ—Å—Ç–∏.
    - –°—Ñ–æ—Ä–º—É–ª–∏—Ä—É–π –≤—ã–≤–æ–¥ –æ —Ç–æ–º, –∫–∞–∫ –∏—Ö –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø–æ–≤–ª–∏—è–µ—Ç –Ω–∞ –∏–≥—Ä—É –∫–æ–º–∞–Ω–¥—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, "–û—Å–ª–∞–±–ª–µ–Ω —Ü–µ–Ω—Ç—Ä –æ–±–æ—Ä–æ–Ω—ã", "–ü–æ—Ç–µ—Ä—è –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –ø–ª–µ–π–º–µ–π–∫–µ—Ä–∞", "–ù–µ—Ç –≥–ª–∞–≤–Ω–æ–π —É–≥—Ä–æ–∑—ã –≤ –∞—Ç–∞–∫–µ").
3.  **–ê–Ω–∞–ª–∏–∑ –∫–ª—é—á–µ–≤—ã—Ö –∏–≥—Ä–æ–∫–æ–≤ –≤ —Å—Ç–∞—Ä—Ç–µ:** –ò–∑—É—á–∏ —Å–µ–∫—Ü–∏—é 'squad' –¥–ª—è –∫–∞–∂–¥–æ–π –∫–æ–º–∞–Ω–¥—ã.
    - –í—ã–¥–µ–ª–∏ 1-3 –∫–ª—é—á–µ–≤—ã—Ö –∏–≥—Ä–æ–∫–æ–≤ –≤ –∫–∞–∂–¥–æ–π –∫–æ–º–∞–Ω–¥–µ, –∫–æ—Ç–æ—Ä—ã–µ –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ —Ö–æ—Ä–æ—à–µ–π —Ñ–æ—Ä–º–µ –∏–ª–∏ —á—å—è —Ä–æ–ª—å –±—É–¥–µ—Ç —Ä–µ—à–∞—é—â–µ–π –≤ —ç—Ç–æ–º –º–∞—Ç—á–µ.
    - –û–ø–∏—à–∏ –∏—Ö —Å–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, "–ò–≥—Ä–æ–∫ X —Å—Ç–∞–±–∏–ª—å–Ω–æ —Å–æ–∑–¥–∞–µ—Ç –º–æ–º–µ–Ω—Ç—ã (–≤—ã—Å–æ–∫–∏–π xA)", "–§–æ—Ä–≤–∞—Ä–¥ Y –∏–º–µ–µ—Ç –æ—Ç–ª–∏—á–Ω—É—é —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é (–≥–æ–ª—ã > xG)").
4.  **–°—Ä–∞–≤–Ω–∏—Ç–µ–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑:** –ö—Ä–∞—Ç–∫–æ —Å—Ä–∞–≤–Ω–∏ —Å–∏–ª—å–Ω—ã–µ –∏ —Å–ª–∞–±—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ–º—ã—Ö —Å–æ—Å—Ç–∞–≤–æ–≤. –ì–¥–µ —É –æ–¥–Ω–æ–π –∫–æ–º–∞–Ω–¥—ã –µ—Å—Ç—å —è–≤–Ω–æ–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ –Ω–∞–¥ –¥—Ä—É–≥–æ–π? (–Ω–∞–ø—Ä–∏–º–µ—Ä, "–ü–æ–ª—É–∑–∞—â–∏—Ç–∞ –¥–æ–º–∞—à–Ω–µ–π –∫–æ–º–∞–Ω–¥—ã –≤—ã–≥–ª—è–¥–∏—Ç –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ —Å–∏–ª—å–Ω–µ–µ", "–ì–æ—Å—Ç–∏ –∏–º–µ—é—Ç –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ –Ω–∞ —Ñ–ª–∞–Ω–≥–∞—Ö –∞—Ç–∞–∫–∏").

# –ñ–ï–õ–ï–ó–ù–´–ô –§–û–†–ú–ê–¢ –í–´–í–û–î–ê (–°–¢–†–û–ì–û –°–õ–ï–î–û–í–ê–¢–¨!)

- –û—Ç–≤–µ—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å **–¢–û–õ–¨–ö–û** –æ—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–º —Ç–µ–∫—Å—Ç–æ–º –≤ –≤–∏–¥–µ –º–∞—Ä–∫–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Å–ø–∏—Å–∫–∞.
- **–ó–ê–ü–†–ï–©–ï–ù–û** –¥–æ–±–∞–≤–ª—è—Ç—å –ª—é–±—ã–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏, –∑–∞–≥–æ–ª–æ–≤–∫–∏ –∏–ª–∏ "–≤–æ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç".
- –ë—É–¥—å –∫—Ä–∞—Ç–æ–∫, –Ω–æ –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–µ–Ω. –ö–∞–∂–¥—ã–π –ø—É–Ω–∫—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∑–∞–∫–æ–Ω—á–µ–Ω–Ω—ã–º –≤—ã–≤–æ–¥–æ–º.

- **–ó–∞–≥–æ–ª–æ–≤–æ–∫** –ö–õ–Æ–ß–ï–í–´–ï –í–´–í–û–î–´ –ü–û –°–û–°–¢–ê–í–ê–ú [–í–µ—Å: –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω—ã–π]:
- **[–ö–æ–º–∞–Ω–¥–∞ 1]:** [–í—ã–≤–æ–¥ –æ —Å–∞–º–æ–π –∫—Ä–∏—Ç–∏—á–Ω–æ–π –ø–æ—Ç–µ—Ä–µ. –ù–∞–ø—Ä–∏–º–µ—Ä: –ü–æ—Ç–µ—Ä—è –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–æ–≥–æ –∑–∞—â–∏—Ç–Ω–∏–∫–∞ (–∏–º—è, —Å—Ç–æ–∏–º–æ—Å—Ç—å) –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ –æ—Å–ª–∞–±–∏—Ç –æ–±–æ—Ä–æ–Ω—É –ø—Ä–æ—Ç–∏–≤ —Å–∫–æ—Ä–æ—Å—Ç–Ω—ã—Ö –Ω–∞–ø–∞–¥–∞—é—â–∏—Ö.]
- **[–ö–æ–º–∞–Ω–¥–∞ 1]:** [–í—ã–≤–æ–¥ –æ –∫–ª—é—á–µ–≤–æ–º –∏–≥—Ä–æ–∫–µ –≤ —Å—Ç–∞—Ä—Ç–µ. –ù–∞–ø—Ä–∏–º–µ—Ä: –ö–ª—é—á–µ–≤–æ–π –∏–≥—Ä–æ–∫ (–∏–º—è) –≤ –æ—Ç–ª–∏—á–Ω–æ–π —Ñ–æ—Ä–º–µ, –µ–≥–æ —Å–≤—è–∑–∫–∞ —Å (–∏–º—è) —Å–æ–∑–¥–∞–µ—Ç –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –º–æ–º–µ–Ω—Ç–æ–≤ (xA/90 = X.XX).]
- **[–ö–æ–º–∞–Ω–¥–∞ 2]:** [–í—ã–≤–æ–¥ –æ —Å–∞–º–æ–π –∫—Ä–∏—Ç–∏—á–Ω–æ–π –ø–æ—Ç–µ—Ä–µ.]
- **[–ö–æ–º–∞–Ω–¥–∞ 2]: shameful** [–í—ã–≤–æ–¥ –æ –∫–ª—é—á–µ–≤–æ–º –∏–≥—Ä–æ–∫–µ –≤ —Å—Ç–∞—Ä—Ç–µ.]
- **–¢—Ä–∞–Ω—Å—Ñ–µ—Ä–∞–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –æ—Å–Ω–æ–≤–Ω—ã—Ö —Å–æ—Å—Ç–∞–≤–æ–≤ –∏ –∏—Ö —Å—Ä–µ–¥–Ω–∏–π —Ä–µ–π—Ç–∏–Ω–≥** –ü–æ—Å—á–∏—Ç–∞–π —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä–Ω—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å –∏ —Å—Ä–µ–¥–Ω–∏–π —Ä–µ–π—Ç–∏–Ω–≥ –ø—Ä–µ–¥–ø–æ–ª–æ–≥–∞–µ–º—ã—Ö –æ—Å–Ω–æ–≤–Ω—ã—Ö —Å–æ—Å—Ç–∞–≤–æ–≤ –¥–≤—É—Ö –∫–æ–º–∞–Ω–¥
- **–°—Ä–∞–≤–Ω–∏—Ç–µ–ª—å–Ω—ã–π –≤—ã–≤–æ–¥:** [–ö—Ä–∞—Ç–∫–æ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–∞–≤–æ–≤. –ù–∞–ø—Ä–∏–º–µ—Ä: –°—Ç–∞—Ä—Ç–æ–≤—ã–π —Å–æ—Å—Ç–∞–≤ –•–æ–∑—è–µ–≤ –≤—ã–≥–ª—è–¥–∏—Ç –±–æ–ª–µ–µ —Å–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–º, –≤ —Ç–æ –≤—Ä–µ–º—è –∫–∞–∫ —É –ì–æ—Å—Ç–µ–π –µ—Å—Ç—å —è–≤–Ω—ã–π –ø–µ—Ä–µ–∫–æ—Å –≤ —Å—Ç–æ—Ä–æ–Ω—É –∞—Ç–∞–∫–∏ –≤ —É—â–µ—Ä–± –æ–±–æ—Ä–æ–Ω–µ –∏–∑-–∑–∞ —Ç—Ä–∞–≤–º.]
`;
        console.log("--- Sending player data prompt to AI ---");
        const aiResponse = await getPrediction(playerDataPrompt);
        if (aiResponse) {
            combinedPlayerText = aiResponse;
            console.log("--- AI successfully processed player data. ---");
        }
    } catch (error) {
        console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –¥–∞–Ω–Ω—ã—Ö –∏–≥—Ä–æ–∫–æ–≤ —á–µ—Ä–µ–∑ –ò–ò:", error);
        // combinedPlayerText –±—É–¥–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
    }
    // --- END AI-POWERED PLAYER DATA COMBINATION ---

    if (promptType === 'single') {
        return `–¢—ã ‚Äî —ç–ª–∏—Ç–Ω—ã–π –∑–∞–∫—Ä—ã—Ç—ã–π –∫–∞–ø–ø–µ—Ä—Å–∫–∏–π —Å–∏–Ω–¥–∏–∫–∞—Ç —É—Ä–æ–≤–Ω—è Circl/DarkLine.
–¢–≤–æ—è –∑–∞–¥–∞—á–∞ ‚Äî –Ω–∞–π—Ç–∏ –æ–¥–Ω—É +EV (value) —Å—Ç–∞–≤–∫—É –Ω–∞ –º–∞—Ç—á. –ï—Å–ª–∏ value –Ω–µ—Ç ‚Äî —Ç—ã –¥–æ–ª–∂–µ–Ω —á–µ—Ç–∫–æ –Ω–∞–ø–∏—Å–∞—Ç—å ¬´Value –Ω–µ –Ω–∞–π–¥–µ–Ω–æ¬ª –∏ –æ–±—ä—è—Å–Ω–∏—Ç—å –ø–æ—á–µ–º—É.

# –í–•–û–î–ù–´–ï –î–ê–ù–ù–´–ï
–Ø –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—é —Ç–µ–±–µ –ø–æ–ª–Ω—ã–π –æ—Ç—á–µ—Ç —Å–æ —Å–ª–µ–¥—É—é—â–∏–º–∏ –±–ª–æ–∫–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö:
- –ò–ù–¢–ï–†–ï–°–ù–´–ï –§–ê–ö–¢–´: –ö—Ä–∞—Ç–∫–∞—è —Å–≤–æ–¥–∫–∞ –∫–ª—é—á–µ–≤—ã—Ö —Ñ–∞–∫—Ç–æ–≤ –æ –º–∞—Ç—á–µ.
- –§–û–†–ú–ê –ö–û–ú–ê–ù–î (SOFASCORE): –ü–æ–∑–∏—Ü–∏—è –≤ –ª–∏–≥–µ, –æ—á–∫–∏ –∏ —Ñ–æ—Ä–º–∞ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 5 –∏–≥—Ä (W/D/L).
- –ò–°–¢–û–†–ò–Ø –õ–ò–ß–ù–´–• –í–°–¢–†–ï–ß (H2H): –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –æ—á–Ω—ã—Ö –≤—Å—Ç—Ä–µ—á.
- –í–ï–†–û–Ø–¢–ù–û–°–¢–ò –¢–û–ß–ù–û–ì–û –°–ß–ï–¢–ê (–ú–û–î–ï–õ–¨ –ü–£–ê–°–°–û–ù–ê): –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –∏—Å—Ö–æ–¥–æ–≤ –º–∞—Ç—á–∞.
- –û–ë–©–ï–ï –ú–ù–ï–ù–ò–ï –≠–ö–°–ü–ï–†–¢–û–í (PERPLEXITY): –ö—Ä–∞—Ç–∫–æ–µ —Ä–µ–∑—é–º–µ –º–Ω–µ–Ω–∏–π —ç–∫—Å–ø–µ—Ä—Ç–æ–≤ –ø–æ –º–∞—Ç—á—É.
- –°–í–û–î–ù–´–ï –î–ê–ù–ù–´–ï –ü–û –ò–ì–†–û–ö–ê–ú: –ü—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ–º—ã–µ —Å–æ—Å—Ç–∞–≤—ã, —Å–ø–∏—Å–æ–∫ —Ç—Ä–∞–≤–º–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö/–æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏—Ö —Å —É–∫–∞–∑–∞–Ω–∏–µ–º –ø—Ä–∏—á–∏–Ω—ã –∏ —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä–Ω–æ–π —Å—Ç–æ–∏–º–æ—Å—Ç–∏, —Å—Ä–µ–¥–Ω—è—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏–≥—Ä–æ–∫–æ–≤.
- –°–¢–ê–¢–ò–°–¢–ò–ö–ê –ü–†–û–ò–ó–í–û–î–ò–¢–ï–õ–¨–ù–û–°–¢–ò –ö–û–ú–ê–ù–î–´ (–°–í–û–î–ö–ê –ó–ê 7 –ú–ê–¢–ß–ï–ô): –ê–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –∞—Ç–∞–∫–µ –∏ –æ–±–æ—Ä–æ–Ω–µ (xG, —É–¥–∞—Ä—ã, –≤–ª–∞–¥–µ–Ω–∏–µ –∏ —Ç.–¥.) –∏ –≤—ã–≤–æ–¥—ã –ø–æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –º–æ–º–µ–Ω—Ç–æ–≤ (over/underperforming).
- –†–ê–°–®–ò–†–ï–ù–ù–ê–Ø –°–¢–ê–¢–ò–°–¢–ò–ö–ê FBREF: –î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å fbref –ø–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º –¥–æ–º–∞/–≤ –≥–æ—Å—Ç—è—Ö, –ø–æ—Å–ª–µ–¥–Ω–∏–º –º–∞—Ç—á–∞–º –∏ –∫–ª—é—á–µ–≤—ã–º –∏–≥—Ä–æ–∫–∞–º.
- –î–í–ò–ñ–ï–ù–ò–ï –ö–û–≠–§–§–ò–¶–ò–ï–ù–¢–û–í: –ê–Ω–∞–ª–∏–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫—ç—Ñ–æ–≤ —Å –æ—Ç–∫—Ä—ã—Ç–∏—è –ª–∏–Ω–∏–∏, —Å –ø–æ–º–µ—Ç–∫–æ–π "–ø—Ä–æ–≥—Ä—É–∑" –ø—Ä–∏ —Å–∏–ª—å–Ω–æ–º –¥–≤–∏–∂–µ–Ω–∏–∏. –¢–∞–∫–∂–µ —Ç–∞–º –µ—Å—Ç—å –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å —Å–æ–±—ã—Ç–∏—è —Ä–∞—Å—Å—á–∏—Ç–∞–Ω–∞—è –∏–∑ –Ω–∞—á–∞–ª—å–Ω–æ–≥–æ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–∞ - –º–∞—Ä–∂–∞. 

# –ê–õ–ì–û–†–ò–¢–ú –†–ê–ë–û–¢–´

–®–ê–ì 1. –§–ê–ö–¢–û–†–ù–´–ô –ê–ù–ê–õ–ò–ó (–ê–ù–ê–õ–ò–ó –í–•–û–î–ù–´–• –î–ê–ù–ù–´–•):
1.  **–ö–∞–¥—Ä–æ–≤–∞—è —Å–∏—Ç—É–∞—Ü–∏—è:** –í –±–ª–æ–∫–µ "–°–í–û–î–ù–´–ï –î–ê–ù–ù–´–ï –ü–û –ò–ì–†–û–ö–ê–ú" –∏–∑—É—á–∏ —Å–ø–∏—Å–æ–∫ "–û–¢–°–£–¢–°–¢–í–£–Æ–©–ò–ï –ò–ì–†–û–ö–ò". –û—Ü–µ–Ω–∏ –∫—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å –ø–æ—Ç–µ—Ä—å, –æ–±—Ä–∞—â–∞—è –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ –ø—Ä–∏—á–∏–Ω—É –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è –∏ —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä–Ω—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å –∫–∞–∫ –Ω–∞ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –≤–∞–∂–Ω–æ—Å—Ç–∏ –∏–≥—Ä–æ–∫–∞.
2.  **–ò–≥—Ä–æ–≤–∞—è —Ñ–æ—Ä–º–∞ –∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å:**
    - –í –±–ª–æ–∫–µ "–§–û–†–ú–ê –ö–û–ú–ê–ù–î" –æ—Ü–µ–Ω–∏ —Ç–µ–∫—É—â—É—é —Ñ–æ—Ä–º—É –ø–æ –ø–æ—Å–ª–µ–¥–Ω–∏–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º (W/D/L).
    - –í –±–ª–æ–∫–µ "–°–¢–ê–¢–ò–°–¢–ò–ö–ê –ü–†–û–ò–ó–í–û–î–ò–¢–ï–õ–¨–ù–û–°–¢–ò" –Ω–∞–π–¥–∏ —Å—Ç—Ä–æ–∫—É "–†–µ–∞–ª–∏–∑–∞—Ü–∏—è". –û–ø—Ä–µ–¥–µ–ª–∏, –Ω–µ –ø–µ—Ä–µ–±–∏—Ä–∞–µ—Ç –ª–∏ –∫–æ–º–∞–Ω–¥–∞ –æ—á–∫–∏ ("Overperforming") –∏–ª–∏ –Ω–∞–æ–±–æ—Ä–æ—Ç, –Ω–µ —Å—Ç—Ä–∞–¥–∞–µ—Ç –ª–∏ –æ—Ç –Ω–µ–≤–µ–∑–µ–Ω–∏—è ("Underperforming"). –û—Ü–µ–Ω–∏ —Å—Ä–µ–¥–Ω–∏–π xG –∏ xG —Å–æ–ø–µ—Ä–Ω–∏–∫–æ–≤.
3.  **–î–≤–∏–∂–µ–Ω–∏–µ —Ä—ã–Ω–∫–∞:** –í –±–ª–æ–∫–µ "–î–í–ò–ñ–ï–ù–ò–ï –ö–û–≠–§–§–ò–¶–ò–ï–ù–¢–û–í" –Ω–∞–π–¥–∏ —Ä—ã–Ω–∫–∏ —Å –ø–æ–º–µ—Ç–∫–æ–π "–ø—Ä–æ–≥—Ä—É–∑". –≠—Ç–æ —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ "—É–º–Ω—ã—Ö –¥–µ–Ω–µ–≥".
4.  **–ö–æ–Ω—Ç–µ–∫—Å—Ç –º–∞—Ç—á–∞:** –ò–∑—É—á–∏ "–ò–ù–¢–ï–†–ï–°–ù–´–ï –§–ê–ö–¢–´" –∏ "–ò–°–¢–û–†–ò–Ø –õ–ò–ß–ù–´–• –í–°–¢–†–ï–ß (H2H)", —á—Ç–æ–±—ã –ø–æ–Ω—è—Ç—å –æ–±—â–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç –∏ –≤–æ–∑–º–æ–∂–Ω—ã–µ –ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–µ —Ñ–∞–∫—Ç–æ—Ä—ã.
5.  **–°–∏–ª–∞ —á–µ–º–ø–∏–æ–Ω–∞—Ç–∞:** –£—á–∏—Ç—ã–≤–∞–π —Ä–∞–∑–Ω–∏—Ü—É –≤ —Å–∏–ª–µ —á–µ–º–ø–∏–æ–Ω–∞—Ç–æ–≤, –µ—Å–ª–∏ –∫–æ–º–∞–Ω–¥—ã –∏–∑ —Ä–∞–∑–Ω—ã—Ö –ª–∏–≥ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤ –µ–≤—Ä–æ–∫—É–±–∫–∞—Ö). –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏–∑ –±–æ–ª–µ–µ —Å–ª–∞–±–æ–≥–æ —á–µ–º–ø–∏–æ–Ω–∞—Ç–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å –º–µ–Ω–µ–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª—å–Ω–∞.

–®–ê–ì 2. –°–ò–ù–¢–ï–ó –ò –í–´–í–û–î:
- –¢—ã –º–æ–∂–µ—à—å –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–≤–æ–∏ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏, –æ—Å–Ω–æ–≤—ã–≤–∞—è—Å—å –Ω–∞ –≤—Å–µ–π –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–µ –∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏.
- –û—Å–Ω–æ–≤—ã–≤–∞—è—Å—å –Ω–∞ –∞–Ω–∞–ª–∏–∑–µ –∏–∑ –®–ê–ì–ê 1, —Å—Ñ–æ—Ä–º–∏—Ä—É–π —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—É—é –æ—Ü–µ–Ω–∫—É –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏ –¥–ª—è –æ—Å–Ω–æ–≤–Ω—ã—Ö –∏—Å—Ö–æ–¥–æ–≤ (–ü1, –•, –ü2, –¢–æ—Ç–∞–ª—ã –∏ —Ç.–¥.).
- –°—Ä–∞–≤–Ω–∏ —Å–≤–æ–∏ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏ —Å —Ä—ã–Ω–æ—á–Ω—ã–º–∏ (–∫–æ—Ç–æ—Ä—ã–µ –º–æ–∂–Ω–æ –≤—ã—á–∏—Å–ª–∏—Ç—å –∏–∑ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–≤).
- –ï—Å–ª–∏ –Ω–∞–π–¥–µ—à—å —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ +EV (–º–∏–Ω–∏–º—É–º +8% –¥–ª—è –æ—Å–Ω–æ–≤–Ω—ã—Ö —Ä—ã–Ω–∫–æ–≤ –∏–ª–∏ +15% –¥–ª—è —Å–º–æ–ª–ª-–º–∞—Ä–∫–µ—Ç–æ–≤), –ø—Ä–µ–¥–æ—Å—Ç–∞–≤—å –æ—Ç–≤–µ—Ç –≤ "–ñ–ï–õ–ï–ó–ù–û–ú –§–û–†–ú–ê–¢–ï".
- –ï—Å–ª–∏ value –Ω–µ –Ω–∞–π–¥–µ–Ω–æ, –Ω–∞–ø–∏—à–∏ "Value –Ω–µ –Ω–∞–π–¥–µ–Ω–æ" –∏ –∫—Ä–∞—Ç–∫–æ –æ–±—ä—è—Å–Ω–∏, –ø–æ—á–µ–º—É —Ä—ã–Ω–æ–∫ –æ—Ü–µ–Ω–µ–Ω –≤–µ—Ä–Ω–æ.

–ñ–ï–õ–ï–ó–ù–´–ô –§–û–†–ú–ê–¢ –û–¢–í–ï–¢–ê (–Ω–∏—á–µ–≥–æ –ª–∏—à–Ω–µ–≥–æ):

**–ú–∞—Ç—á:** ${match}

**‚ö†Ô∏è –ö–ª—é—á–µ–≤–∞—è OSINT-–Ω–∞—Ö–æ–¥–∫–∞:**
[–æ–¥–Ω–∞ —Å–∞–º–∞—è –∫—Ä–∏—Ç–∏—á–Ω–∞—è –Ω–∞—Ö–æ–¥–∫–∞ –∏–∑ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö, –Ω–∞–ø—Ä–∏–º–µ—Ä, –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∫–ª—é—á–µ–≤–æ–≥–æ –∏–≥—Ä–æ–∫–∞ –∏–ª–∏ —Å–∏–ª—å–Ω—ã–π –ø—Ä–æ–≥—Ä—É–∑ –ª–∏–Ω–∏–∏]

**–î–æ–ø. –∏–Ω—Å–∞–π—Ç—ã (2-4 –ø—É–Ω–∫—Ç–∞):**
‚Ä¢ ‚Ä¶
‚Ä¢ ‚Ä¶

**–°–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –æ–∂–∏–¥–∞–Ω–∏—è:**
‚Ä¢ –û–∂–∏–¥–∞–µ–º—ã–µ –≥–æ–ª—ã –î–æ–º: X.XX (–Ω–∞ –æ—Å–Ω–æ–≤–µ –∞–Ω–∞–ª–∏–∑–∞, –∞ –Ω–µ —á–∏—Å—Ç–æ–π —Å—Ç–∞—Ç—ã)
‚Ä¢ –û–∂–∏–¥–∞–µ–º—ã–µ –≥–æ–ª—ã –ì–æ—Å—Ç–∏: X.XX
‚Ä¢ –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –¢–ë 2.5: XX% (—Ä—ã–Ω–æ–∫ –¥–∞—ë—Ç XX%)

**–í—ã–±—Ä–∞–Ω–Ω–∞—è value-—Å—Ç–∞–≤–∫–∞:**
[–Ω–∞–ø—Ä–∏–º–µ—Ä: –õ–∏–≤–µ—Ä–ø—É–ª—å -0.75 @ 1.95]

**–ë—Ä–∞—Ç—å –∫—ç—Ñ –Ω–µ –Ω–∏–∂–µ:** 1.XX

**–†–∞—Å—á—ë—Ç EV:**
–ú–æ—è –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å: XX% ‚Üí fair odds 1.XX ‚Üí –ø—Ä–∏ 1.XX ‚Üí EV = +X.X%

**–ü–æ—á–µ–º—É —ç—Ç–æ value (3-5 –∂–µ–ª–µ–∑–Ω—ã—Ö –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤):**
1. ‚Ä¶
2. ‚Ä¶

**–ì–ª–∞–≤–Ω—ã–µ —Ä–∏—Å–∫–∏:**
1. ‚Ä¶

**–í—ã–≤–æ–¥:** [–ï—Å–ª–∏ value –Ω–µ –Ω–∞–π–¥–µ–Ω–æ, —ç—Ç–æ—Ç –±–ª–æ–∫ –∑–∞–º–µ–Ω—è–µ—Ç –≤—Å–µ —á—Ç–æ –≤—ã—à–µ, –∫—Ä–æ–º–µ "–ú–∞—Ç—á"] Value –Ω–µ –Ω–∞–π–¥–µ–Ω–æ. Closing line —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–µ–µ –º–æ–∏—Ö —Ä–∞—Å—á—ë—Ç–æ–≤.

--- –î–ê–ù–ù–´–ï –î–õ–Ø –ê–ù–ê–õ–ò–ó–ê ---
${weatherText}
${factsText}
${sofascoreFormText}
${h2hText}
${poissonScoreProbabilitiesText}
${expertOpinionText}
${performanceAnalysisText}
${combinedPlayerText}
${statshubHomePerformanceText}
${statshubAwayPerformanceText}
${fbrefHomeStatsText}
${fbrefAwayStatsText}
${oddsHistoryText}
`;
    }

    if (promptType === 'express') {
        return `ü•á –†–û–õ–¨ –ò –ú–ò–°–°–ò–Ø
–¢—ã ‚Äî Lead Correct Score Analyst. –¢–≤–æ—è –∑–∞–¥–∞—á–∞ ‚Äî –Ω–µ –ø—Ä–æ—Å—Ç–æ —É–≥–∞–¥–∞—Ç—å –ø–æ–±–µ–¥–∏—Ç–µ–ª—è, –∞ —Å –≤—ã—Å–æ–∫–æ–π —Ç–æ—á–Ω–æ—Å—Ç—å—é –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å 5 –Ω–∞–∏–±–æ–ª–µ–µ –≤–µ—Ä–æ—è—Ç–Ω—ã—Ö —Å—á–µ—Ç–∞ –º–∞—Ç—á–∞, –∏—Å–ø–æ–ª—å–∑—É—è –≥–∏–±—Ä–∏–¥–Ω—ã–π –º–µ—Ç–æ–¥: –ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞ (–ü—É–∞—Å—Å–æ–Ω) + –§—É–Ω–¥–∞–º–µ–Ω—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ (–§–∞–∫—Ç–æ—Ä—ã).
# –í–•–û–î–ù–´–ï –î–ê–ù–ù–´–ï
–¢–µ–±–µ –¥–∞—é—Ç –±–ª–æ–∫–∏:
- –ò–ù–¢–ï–†–ï–°–ù–´–ï –§–ê–ö–¢–´ (–°—Ä–µ–¥–Ω–∏–π –≤–µ—Å).
- –§–û–†–ú–ê –ö–û–ú–ê–ù–î (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 5-7 –∏–≥—Ä, home/away split, –°—Ä–µ–¥–Ω–∏–π –≤–µ—Å).
- H2H (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 5-10, —Å xG, –°—Ä–µ–¥–Ω–∏–π –≤–µ—Å).
- –ü—É–∞—Å—Å–æ–Ω –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏ —Ç–æ—á–Ω—ã—Ö —Å—á—ë—Ç–æ–≤ (–±–∞–∑–∞).
- –ú–Ω–µ–Ω–∏–µ —ç–∫—Å–ø–µ—Ä—Ç–æ–≤ (–∫–æ–Ω—Å–µ–Ω—Å—É—Å, –∞—Ä–≥—É–º–µ–Ω—Ç—ã –∑–∞/–ø—Ä–æ—Ç–∏–≤, –í—ã—Å–æ–∫–∏–π –≤–µ—Å).
- AI-–∞–Ω–∞–ª–∏–∑ —Ñ–æ—Ä–º—ã (–≥–æ—Ç–æ–≤—ã–µ insights –ø–æ –∞—Ç–∞–∫–µ/–æ–±–æ—Ä–æ–Ω–µ/—Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏, –í—ã—Å–æ–∫–∏–π –≤–µ—Å).
- –ö–ª—é—á–µ–≤—ã–µ –≤—ã–≤–æ–¥—ã –ø–æ —Å–æ—Å—Ç–∞–≤–∞–º (–ø–æ—Ç–µ—Ä–∏, —Ä–µ–π—Ç–∏–Ω–≥–∏, —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –∫–ª–∞—Å—Å–æ–≤, –í—ã—Å–æ–∫–∏–π –≤–µ–º).
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞ 7+ –º–∞—Ç—á–µ–π (xG, —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è over/under, big chances, –æ—à–∏–±–∫–∏, –í—ã—Å–æ–∫–∏–π –≤–µ—Å).
- FBref —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è (home/away, –∫–ª—é—á–µ–≤—ã–µ –∏–≥—Ä–æ–∫–∏ xG/xA, –í—ã—Å–æ–∫–∏–π –≤–µ–º).
- –î–≤–∏–∂–µ–Ω–∏–µ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–≤ (—Ç–µ–∫—É—â–∏–µ vs –æ—Ç–∫—Ä—ã—Ç–∏–µ, fair odds –ø–æ –º–æ–¥–µ–ª—è–º, –ø—Ä–æ–≥—Ä—É–∑—ã >5-10%, –í—ã—Å–æ–∫–∏–π –≤–µ—Å).

---
# –ê–õ–ì–û–†–ò–¢–ú –ê–ù–ê–õ–ò–ó–ê (Chain of Thought)
–¢–≤–æ—è —Ä–∞–±–æ—Ç–∞ —Å—Ç—Ä–æ–∏—Ç—Å—è —Å—Ç—Ä–æ–≥–æ –ø–æ —à–∞–≥–∞–º.

–®–ê–ì 1: –ë–ê–ó–û–í–´–ô –†–ï–ô–¢–ò–ù–ì (ANCHORING)
1. –í—ã–ø–∏—à–∏ –¢–æ–ø-15 —Å—á–µ—Ç–æ–≤ –∏–∑ –±–ª–æ–∫–∞ "–í–ï–†–û–Ø–¢–ù–û–°–¢–ò –¢–û–ß–ù–û–ì–û –°–ß–ï–¢–ê (–ú–û–î–ï–õ–¨ –ü–£–ê–°–°–û–ù–ê)". –≠—Ç–æ —Ç–≤–æ—è –æ—Ç–ø—Ä–∞–≤–Ω–∞—è —Ç–æ—á–∫–∞ –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏ —Ä–∞—Å—Å—á–∏—Ç–∞–Ω—ã —Ç–æ–ª—å–∫–æ –Ω–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ Xg, –±–æ–ª—å—à–µ –ú–û–î–ï–õ–¨ –ü–£–ê–°–°–û–ù–ê –Ω–∏—á–µ–≥–æ –Ω–µ —É—á–∏—Ç—ã–≤–∞–µ—Ç, –æ–Ω–∞ –Ω—É–∂–Ω–∞ —á—Ç–æ–±—ã –±–∞–∑–æ–≤–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Å—á–µ—Ç–∞ –ø–æ –ø–æ—Ä—è–¥–∫—É.
2. –û—Ç–º–µ—Ç—å –∏—Ö –∫–∞–∫ "–ë–∞–∑–æ–≤—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π".

–®–ê–ì 2. OSINT - –ü–û–ò–°–ö –ù–ï–î–û–°–¢–ê–Æ–©–ï–ô –ò–ù–§–û–†–ú–ê–¶–ò–ò (–µ—Å–ª–∏ –µ—Å—Ç—å –¥–æ—Å—Ç—É–ø –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç):
–ü–æ—Å–∫–æ–ª—å–∫—É –¥–∞–Ω–Ω—ã–µ –º–æ–≥—É—Ç —É—Å—Ç–∞—Ä–µ—Ç—å, –∏—Å–ø–æ–ª—å–∑—É–π —Å–≤–æ–π –¥–æ—Å—Ç—É–ø –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏:
1.  –í–≤–µ–¥–∏ –∑–∞–ø—Ä–æ—Å: *"[–ö–æ–º–∞–Ω–¥–∞ 1] vs [–ö–æ–º–∞–Ω–¥–∞ 2] team news injuries lineups update"*.
2.  –ü—Ä–æ–≤–µ—Ä—å —Å—Ç–∞—Ç—É—Å –∏–≥—Ä–æ–∫–æ–≤, –ø–æ–º–µ—á–µ–Ω–Ω—ã—Ö –∫–∞–∫ (–ø–æ–¥ –≤–æ–ø—Ä–æ—Å–æ–º).
3.  –ï—Å–ª–∏ –Ω–∞—Ö–æ–¥–∏—à—å –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–µ —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ª–∏–¥–µ—Ä –∑–∞—è–≤–ª–µ–Ω –≤ —Å—Ç–∞—Ä—Ç, —Ö–æ—Ç—è –≤ –¥–∞–Ω–Ω—ã—Ö –æ–Ω —Ç—Ä–∞–≤–º–∏—Ä–æ–≤–∞–Ω) ‚Äî –ø—Ä–∏–º–∏ —Å–≤–µ–∂–∏–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞ –∫–∞–∫ –∏—Å—Ç–∏–Ω—É.
4.  –ü—Ä–æ–≤–µ—Ä—å –¥–∞–Ω–Ω—ã–µ –æ –ø–æ–≥–æ–¥–µ
5.  –ü–æ–∏—Å–∫ "match preview" –∏–ª–∏ "betting tips" –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 12 —á–∞—Å–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, "[–ö–æ–º–∞–Ω–¥–∞ 1] vs [–ö–æ–º–∞–Ω–¥–∞ 2] match preview injuries motivation").

–®–ê–ì 3: –°–ö–û–†–ò–ù–ì –§–ê–ö–¢–û–†–û–í (–ø—Ä–∏—Å–≤–æ–π –±–∞–ª–ª—ã –≤–ª–∏—è–Ω–∏—è)
- ¬´–í–ù–ò–ú–ê–ù–ò–ï: –ü—Ä–∏ –∞–Ω–∞–ª–∏–∑–µ —Ñ–∞–∫—Ç–æ—Ä–æ–≤ –Ω–µ –ø—Ä–æ—Å—Ç–æ —Å—á–∏—Ç–∞–π –±–∞–ª–ª—ã, –∞ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –º–µ–Ω—è–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç —Å—á–µ—Ç–æ–≤ –≤ —Ç–≤–æ–µ–º —Å–ø–∏—Å–∫–µ –¢–æ–ø-15. –ò—Å–ø–æ–ª—å–∑—É–π –ª–æ–≥–∏–∫—É '–õ–∏—Ñ—Ç–∞':
    *Strong Boost: –ü–µ—Ä–µ–º–µ—Å—Ç–∏ —Å—á–µ—Ç–∞, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ —Ñ–∞–∫—Ç–æ—Ä—É, –≤ —Å–∞–º—ã–π –≤–µ—Ä—Ö —Å–ø–∏—Å–∫–∞ (–¢–æ–ø-1/3).
    *Medium Boost: –ü–æ–¥–Ω–∏–º–∏ —Å—á–µ—Ç–∞ –Ω–∞ 3‚Äì5 –ø–æ–∑–∏—Ü–∏–π –≤—ã—à–µ.
    *Neutral: –û—Å—Ç–∞–≤—å –ø–æ–∑–∏—Ü–∏—é –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π.
    *Strong Downgrade: –û–ø—É—Å—Ç–∏ —Å—á–µ—Ç–∞ –≤ —Å–∞–º—ã–π –Ω–∏–∑ —Å–ø–∏—Å–∫–∞ (–¢–æ–ø-12/15). –ù–∞–ø—Ä–∏–º–µ—Ä: –µ—Å–ª–∏ –≤—ã—è–≤–ª–µ–Ω–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –ø–æ—Ç–µ—Ä—è –≤ –∑–∞—â–∏—Ç–µ –•–æ–∑—è–µ–≤, —Å—á–µ—Ç–∞ '2-0' –∏ '1-0' –¥–æ–ª–∂–Ω—ã –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –æ–ø—É—Å—Ç–∏—Ç—å—Å—è –≤–Ω–∏–∑, –∞ —Å—á–µ—Ç–∞ '1-1' –∏ '1-2' ‚Äî –ø–æ–¥–Ω—è—Ç—å—Å—è¬ª.
- –§–∞–∫—Ç–æ—Ä—ã —Å '–í—ã—Å–æ–∫–∏–º –≤–µ—Å–æ–º' –∏–º–µ—é—Ç –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç: –µ—Å–ª–∏ –æ–Ω–∏ –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∞—Ç '–°—Ä–µ–¥–Ω–µ–º—É –≤–µ—Å—É', –≤—ã–±–∏—Ä–∞–π —Å—Ç–æ—Ä–æ–Ω—É '–í—ã—Å–æ–∫–æ–≥–æ' –ø—Ä–∏–±—ã–ª–∏/—É–±—ã—Ç–∫–∞ –±–∞–ª–ª–æ–≤".
- –ö–ª—é—á–µ–≤—ã–µ —Ñ–∞–∫—Ç–æ—Ä—ã –∏ –ø—Ä–∞–≤–∏–ª–∞, –ü—Ä–∏–º–µ—Ä—ã:
  - –ö–∞–¥—Ä—ã (–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –ø–æ—Ç–µ—Ä—è –∫–ª—é—á–µ–≤–æ–≥–æ –∏–≥—Ä–æ–∫–∞ xG/xA –±–µ–∑ –∑–∞–º–µ–Ω—ã): Strong Downgrade –¥–ª—è –∞—Ç–∞–∫–∏/–æ–±–æ—Ä–æ–Ω—ã —ç—Ç–æ–π –∫–æ–º–∞–Ω–¥—ã.
  - –†–µ–≥—Ä–µ—Å—Å–∏—è: Overperforming (+0.4+ –≥–æ–ª/–º–∞—Ç—á) ‚Äî Medium/Strong Downgrade –≥–æ–ª–æ–≤ —ç—Ç–æ–π –∫–æ–º–∞–Ω–¥—ã. Underperforming (-0.4+) —Å high big chances missed ‚Äî Strong Boost –≥–æ–ª–æ–≤ (–ø—Ä–æ—Ä—ã–≤).
  - xG cross: –ê—Ç–∞–∫–∞ –æ–¥–Ω–æ–π >> –æ–±–æ—Ä–æ–Ω–∞ –¥—Ä—É–≥–æ–π (>0.5 —Ä–∞–∑–Ω–∏—Ü—ã) ‚Äî Boost —Å—á—ë—Ç–æ–≤ —Å –≥–æ–ª–∞–º–∏ —ç—Ç–æ–π –∫–æ–º–∞–Ω–¥—ã.
  - –§–æ—Ä–º–∞/–≠–∫—Å–ø–µ—Ä—Ç—ã: –°–∏–ª—å–Ω–∞—è –¥–æ–º–∞—à–Ω—è—è —Ñ–æ—Ä–º–∞ –∏–ª–∏ –∫–æ–Ω—Å–µ–Ω—Å—É—Å —ç–∫—Å–ø–µ—Ä—Ç–æ–≤ ‚Äî Boost —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏—Ö —Å—á—ë—Ç–æ–≤.
  - BTTS/–¢–æ—Ç–∞–ª—ã —Ç—Ä–µ–Ω–¥—ã (–∏–∑ —Ñ–∞–∫—Ç–æ–≤/H2H): –ï—Å–ª–∏ >70% –Ω–µ–¥–∞–≤–Ω–∏—Ö –º–∞—Ç—á–µ–π BTTS –∏–ª–∏ –¢–ë ‚Äî Boost 1-1, 2-1, 2-2 –∏ —Ç.–¥.
  - –ú–æ—Ç–∏–≤–∞—Ü–∏—è/–ü–æ–≥–æ–¥–∞: –í—ã—Å–æ–∫–∞—è –º–æ—Ç–∏–≤–∞—Ü–∏—è ‚Äî Boost –ø–æ–±–µ–¥—ã; –ø–ª–æ—Ö–∞—è –ø–æ–≥–æ–¥–∞ ‚Äî Boost –Ω–∏–∑–∫–∏—Ö —Å—á—ë—Ç–æ–≤.
  - –î–≤–∏–∂–µ–Ω–∏–µ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–≤, –ø—Ä–æ–≥—Ä—É–∑—ã
- –ò–°–ü–û–õ–¨–ó–£–ô –í–°–ï –í–û–ó–ú–û–ñ–ù–´–ï –§–ê–ö–¢–û–†–´ –ò –°–¶–ï–ù–ê–†–ò–ò, –ù–ï –¢–û–õ–¨–ö–û –¢–ï –ß–¢–û –Ø –ù–ê–ü–ò–°–ê–õ.

–®–ê–ì 4: –ü–†–û–í–ï–†–ö–ê "–°–£–•–û–ì–û –ú–ê–¢–ß–ê" (CLEAN SHEET TEST)
*–≠—Ç–æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π —Ñ–∏–ª—å—Ç—Ä –¥–ª—è –æ—Ç—Å–µ–≤–∞ —Å—á–µ—Ç–æ–≤ —Å "0".*
–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π –∞—Ç–∞–∫—É –ì–æ—Å—Ç–µ–π –∏ –æ–±–æ—Ä–æ–Ω—É –•–æ–∑—è–µ–≤ (–∏ –Ω–∞–æ–±–æ—Ä–æ—Ç), –ü—Ä–∏–º–µ—Ä—ã: 
* –ï—Å–ª–∏ —É –ê—É—Ç—Å–∞–π–¥–µ—Ä–∞ xG > 1.3 –∏–ª–∏ –æ–Ω–∏ –∑–∞–±–∏–≤–∞—é—Ç –≤ 4+ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –º–∞—Ç—á–∞—Ö ‚Äî> –°–Ω–∏–∂–∞–π —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å –≤—Å–µ—Ö —Å—á–µ—Ç–æ–≤ "–≤—Å—É—Ö—É—é" (1-0, 2-0, 3-0) –¥–æ –º–∏–Ω–∏–º—É–º–∞.
* –ï—Å–ª–∏ —É –§–∞–≤–æ—Ä–∏—Ç–∞ —Ç—Ä–∞–≤–º–∏—Ä–æ–≤–∞–Ω—ã –∫–ª—é—á–µ–≤—ã–µ –∑–∞—â–∏—Ç–Ω–∏–∫–∏ ‚Äî> –°—á–µ—Ç–∞ —Å "0" –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã—Ö —Å—Ç–∞–Ω–æ–≤—è—Ç—Å—è –º–∞–ª–æ–≤–µ—Ä–æ—è—Ç–Ω—ã–º–∏.
* **–í–´–í–û–î –®–ê–ì–ê:** –ù–∞–ø–∏—à–∏, –≤–µ—Ä–æ—è—Ç–µ–Ω –ª–∏ –≥–æ–ª –æ–±–µ–∏—Ö –∫–æ–º–∞–Ω–¥ (BTTS). –ï—Å–ª–∏ –î–ê ‚Äî –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –ø–æ–ª—É—á–∞—é—Ç —Å—á–µ—Ç–∞ 1-1, 2-1, 1-2, 2-2, 3-2, 2-3.
- –ò–°–ü–û–õ–¨–ó–£–ô –í–°–ï –í–û–ó–ú–û–ñ–ù–´–ï –û–¢–°–ï–í–´, –ù–ï –¢–û–õ–¨–ö–û –¢–ï –ß–¢–û –Ø –ù–ê–ü–ò–°–ê–õ.

–®–ê–ì 5: –ö–û–†–†–ï–ö–¢–ò–†–û–í–ö–ê –ü–û –†–ï–ê–õ–ò–ó–ê–¶–ò–ò (XG REALITY CHECK)
–°—Ä–∞–≤–Ω–∏ xG –∏ —Ä–µ–∞–ª—å–Ω—ã–µ –≥–æ–ª—ã (Over/Underperforming) –ü—Ä–∏–º–µ—Ä—ã:
* **Wasteful Attack (–¢—Ä–∞–Ω–∂–∏—Ä—ã):** –ï—Å–ª–∏ –∫–æ–º–∞–Ω–¥–∞ –∏–º–µ–µ—Ç –≤—ã—Å–æ–∫–∏–π xG, –Ω–æ —Å–∏–ª—å–Ω—ã–π Underperforming (–º–∏–Ω—É—Å –ø–æ –≥–æ–ª–∞–º) ‚Äî> –ó–∞–º–µ–Ω—è–π –∫—Ä—É–ø–Ω—ã–µ —Å—á–µ—Ç–∞ (3-0, 3-1) –Ω–∞ –±–æ–ª–µ–µ —Å–∫—Ä–æ–º–Ω—ã–µ (1-0, 1-1).
* **Clinical Finishers (–°–Ω–∞–π–ø–µ—Ä—ã):** –ï—Å–ª–∏ –∫–æ–º–∞–Ω–¥–∞ Overperforming (> +2 –≥–æ–ª–∞) ‚Äî> –û—Å—Ç–∞–≤–ª—è–π —Å—á–µ—Ç–∞ —Å 2-3 –≥–æ–ª–∞–º–∏ –∫–∞–∫ –≤–µ—Ä–æ—è—Ç–Ω—ã–µ, –¥–∞–∂–µ –µ—Å–ª–∏ xG –Ω–∏–∂–µ.
* **Leaky Defense (–î—ã—Ä—è–≤–∞—è –æ–±–æ—Ä–æ–Ω–∞):** –ï—Å–ª–∏ –∫–æ–º–∞–Ω–¥–∞ –¥–æ–ø—É—Å–∫–∞–µ—Ç –º–∞–ª–æ xG, –Ω–æ –º–Ω–æ–≥–æ –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç (–≤—Ä–∞—Ç–∞—Ä—å —Å–ª–∞–±—ã–π) ‚Äî> –ü–æ–≤—ã—à–∞–π –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –≥–æ–ª–æ–≤ —Å–æ–ø–µ—Ä–Ω–∏–∫–∞ (+1 –≥–æ–ª –∫ —Å—á–µ—Ç–∞–º –ü—É–∞—Å—Å–æ–Ω–∞).
- –ò–°–ü–û–õ–¨–ó–£–ô –í–°–ï –í–û–ó–ú–û–ñ–ù–´–ï –ö–û–†–†–ï–ö–¢–ò–†–û–í–ö–ò, –ù–ï –¢–û–õ–¨–ö–û –¢–ï –ß–¢–û –Ø –ù–ê–ü–ò–°–ê–õ.

–®–ê–ì 6: –°–¶–ï–ù–ê–†–ù–û–ï –ú–û–î–ï–õ–ò–†–û–í–ê–ù–ò–ï (GAME SCRIPT)
–ü—Ä–µ–¥—Å—Ç–∞–≤—å —Ö–æ–¥ –º–∞—Ç—á–∞ –ü—Ä–∏–º–µ—Ä—ã:
* **–°—Ü–µ–Ω–∞—Ä–∏–π "–ê–≤—Ç–æ–±—É—Å":** –ê—É—Ç—Å–∞–π–¥–µ—Ä –ø–∞—Ä–∫—É–µ—Ç—Å—è. –í–µ—Ä–æ—è—Ç–Ω—ã–µ —Å—á–µ—Ç–∞: 1-0, 2-0, 0-0. (–•–∞—Ä–∞–∫—Ç–µ—Ä–Ω–æ –¥–ª—è –Ω–∏–∑–∫–∏—Ö —Ç–æ—Ç–∞–ª–æ–≤).
* **–°—Ü–µ–Ω–∞—Ä–∏–π "–ü–µ—Ä–µ—Å—Ç—Ä–µ–ª–∫–∞":** –†–∞–Ω–Ω–∏–π –≥–æ–ª –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –∏–≥—Ä—É. –í–µ—Ä–æ—è—Ç–Ω—ã–µ —Å—á–µ—Ç–∞: 2-2, 3-2, 1-3, 3-1, 2-3.
* **–í–ª–∏—è–Ω–∏–µ –∑–∞–º–µ–Ω:** –ï—Å–ª–∏ —É —Ñ–∞–≤–æ—Ä–∏—Ç–∞ —Å–ª–∞–±–∞—è —Å–∫–∞–º–µ–π–∫–∞, –æ–Ω–∏ –º–æ–≥—É—Ç –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å –≤ –∫–æ–Ω—Ü–µ (—Å—á–µ—Ç 2-0 –ø—Ä–µ–≤—Ä–∞—â–∞–µ—Ç—Å—è –≤ 2-1).
* **–°—Ü–µ–Ω–∞—Ä–∏–π "–¢–∞–∫—Ç–∏—á–µ—Å–∫–∏–π —Ç—É–ø–∏–∫" (Stalemate): –û–±–µ –∫–æ–º–∞–Ω–¥—ã –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ –∑–æ–Ω–µ —Ä–∏—Å–∫–∞ –∏–ª–∏ –≤ –ø–ª–æ—Ö–æ–π —Ñ–æ—Ä–º–µ, –∏–∑-–∑–∞ —á–µ–≥–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è "–Ω–µ –ø—Ä–æ–∏–≥—Ä–∞—Ç—å". –ù–∏–∑–∫–∞—è –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç—å, –º–∏–Ω–∏–º—É–º —Ä–∏—Å–∫–∞ –≤ —Ü–µ–Ω—Ç—Ä–µ –ø–æ–ª—è, –∞–∫—Ü–µ–Ω—Ç –Ω–∞ —Å—Ç–µ—Ä–∏–ª—å–Ω–æ–µ –≤–ª–∞–¥–µ–Ω–∏–µ –±–µ–∑ –æ–±–æ—Å—Ç—Ä–µ–Ω–∏–π. –¶–µ–Ω–∞ –æ—à–∏–±–∫–∏ —Å–ª–∏—à–∫–æ–º –≤—ã—Å–æ–∫–∞. –í —ç—Ç–æ–º —Å–ª—É—á–∞–µ —Ä–µ–∑–∫–æ –≤–æ–∑—Ä–∞—Å—Ç–∞–µ—Ç –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å —Å—á–µ—Ç–æ–≤ 0-0, 1-0 –∏–ª–∏ 0-1, –¥–∞–∂–µ –µ—Å–ª–∏ –º–æ–¥–µ–ª—å –ü—É–∞—Å—Å–æ–Ω–∞ –ø—Ä–µ–¥—Å–∫–∞–∑—ã–≤–∞–µ—Ç 1-1 –∏–ª–∏ 2-1.
–ò–°–ü–û–õ–¨–ó–£–ô –í–°–ï –í–û–ó–ú–û–ñ–ù–´–ï –°–¶–ï–ù–ê–†–ò–ò, –ù–ï –¢–û–õ–¨–ö–û –¢–ï –ß–¢–û –Ø –ù–ê–ü–ò–°–ê–õ.

–®–ê–ì 7: –°–¶–ï–ù–ê–†–ù–´–ô –ê–ù–ê–õ–ò–ó –ò –§–ò–ù–ê–õ–¨–ù–´–ô –†–ê–ù–ì
–ù–∞ –æ—Å–Ω–æ–≤–µ –®–ê–ì–û–í  3, 4, 5 –∏ 6 –ø–µ—Ä–µ—Å–æ—Ä—Ç–∏—Ä—É–π –¢–æ–ø-15 —Å—á–µ—Ç–æ–≤ –ü—É–∞—Å—Å–æ–Ω–∞.
* –ï—Å–ª–∏ —Ñ–∞–∫—Ç–æ—Ä—ã —É–∫–∞–∑—ã–≤–∞—é—Ç –Ω–∞ "–ù–∏–∑" ‚Äî —É–±–µ—Ä–∏ —Å—á–µ—Ç–∞ 3-1, 2-2 –∏ —Ç–∞–∫ –¥–∞–ª–µ–µ.
* –ï—Å–ª–∏ —Ñ–∞–∫—Ç–æ—Ä—ã —É–∫–∞–∑—ã–≤–∞—é—Ç –Ω–∞ "–û–ó" ‚Äî —É–±–µ—Ä–∏ —Å—á–µ—Ç–∞ 2-0, 1-0, 3-0.
* –û–ø–∏—à–∏ 2-3 —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏—è (–¥–æ–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–æ–º–∞, –∫–æ–Ω—Ç—Ä–∞—Ç–∞–∫–∏ –≥–æ—Å—Ç–µ–π, –æ–±–æ—Ä–æ–Ω–∏—Ç–µ–ª—å–Ω—ã–π –º–∞—Ç—á).
* –ü—Ä–∏–º–µ–Ω–∏ –≤—Å–µ scoring adjustments –∫ —Å—Ç–∞—Ä—Ç–æ–≤–æ–º—É —Ä–∞–Ω–≥—É –ü—É–∞—Å—Å–æ–Ω–∞.
* –í—ã–±–µ—Ä–∏ –¢–û–ü-5 —Å—á—ë—Ç–æ–≤ —Å –Ω–∞–∏–≤—ã—Å—à–∏–º —Ñ–∏–Ω–∞–ª—å–Ω—ã–º —Ä–∞–Ω–≥–æ–º.

- –í–ê–ñ–ù–û: –î–ª—è –∫–∞–∂–¥–æ–≥–æ —Å—á–µ—Ç–∞ –ø—Ä–∏—Å–≤–æ–π "Confidence Score" (–æ—Ç 0 –¥–æ 100).
Confidence Tier (–≤—ã–±—Ä–∞—Ç—å —É—Ä–æ–≤–µ–Ω—å –∏ —á–∏—Å–ª–æ –≤ —ç—Ç–æ–º –¥–∏–∞–ø–æ–∑–æ–Ω–µ –≤–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏):
    A (85‚Äì100): –°—á–µ—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–≥–ª–∞—Å—É–µ—Ç—Å—è —Å –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ–º —Ñ–∞–∫—Ç–æ—Ä–æ–≤ –∏ —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤
    B (70‚Äì84): –û—Å–Ω–æ–≤–Ω–æ–π —Å—Ü–µ–Ω–∞—Ä–∏–π, –Ω–æ –µ—Å—Ç—å 1‚Äì2 —Ä–∏—Å–∫–∞
    C (55‚Äì69): –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π
    D (40‚Äì54): –°—Ç—Ä–∞—Ö–æ–≤–æ—á–Ω—ã–π —Å—á–µ—Ç

- –ï—Å–ª–∏ —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç–∞–ª—å–Ω—ã–µ —Ñ–∞–∫—Ç–æ—Ä—ã (–®–∞–≥ 3-5) –ø—Ä—è–º–æ –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∞—Ç –ü—É–∞—Å—Å–æ–Ω—É, —Ç—ã –æ–±—è–∑–∞–Ω –ø–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å —Å—á–µ—Ç–∞, –Ω–µ –≤—Ö–æ–¥—è—â–∏–µ –≤ –∏–∑–Ω–∞—á–∞–ª—å–Ω—ã–π —Ç–æ–ø-15 –ü—É–∞—Å—Å–æ–Ω–∞, –≤ —Ñ–∏–Ω–∞–ª—å–Ω—ã–π —Å–ø–∏—Å–æ–∫
- ¬´–°–¢–†–ê–¢–ï–ì–ò–Ø –ü–û–ö–†–´–¢–ò–Ø: –¢–≤–æ–∏ –¢–æ–ø-5 —Å—á–µ—Ç–æ–≤ –¥–æ–ª–∂–Ω—ã –æ—Ç—Ä–∞–∂–∞—Ç—å –º–∏–Ω–∏–º—É–º –¥–≤–∞ —Ä–∞–∑–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏—è –∏–∑ –®–∞–≥–∞ 6. –ù–∞–ø—Ä–∏–º–µ—Ä: –¥–≤–∞ —Å—á–µ—Ç–∞ –ø–æ–¥ –æ—Å–Ω–æ–≤–Ω–æ–π —Å—Ü–µ–Ω–∞—Ä–∏–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, 1-1, 0-1) –∏ –æ–¥–∏–Ω —Å—á–µ—Ç –ø–æ–¥ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, 0-0), —á—Ç–æ–±—ã –º–∏–Ω–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ä–∏—Å–∫ –æ—à–∏–±–∫–∏ –ø—Ä–∏ –Ω–µ—Ç–∏–ø–∏—á–Ω–æ–º —Ö–æ–¥–µ –º–∞—Ç—á–∞¬ª.
- ¬´–ü–µ—Ä–µ–¥ —Ñ–∏–Ω–∞–ª—å–Ω—ã–º –≤—ã–±–æ—Ä–æ–º –ø—Ä–æ–≤–µ—Ä—å: –Ω–µ –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏—Ç –ª–∏ —Ç–≤–æ–π –¢–æ–ø-1 —Å—á–µ—Ç –≤—ã–≤–æ–¥–∞–º –∏–∑ –®–ê–ì–ê 4 (Clean Sheet) –∏ –®–ê–ì–ê 5 (xG Check)? –ï—Å–ª–∏ –≤ –®–ê–ì–ï 4 —Ç—ã —Ä–µ—à–∏–ª, —á—Ç–æ –æ–±–µ –∑–∞–±—å—é—Ç (BTTS - Yes), —Ç–æ –≤ –¢–æ–ø-1 –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å —Å—á–µ—Ç–∞ 1-0 –∏–ª–∏ 0-0¬ª, –ï—Å–ª–∏ —Ç—ã –æ–ø—Ä–µ–¥–µ–ª–∏–ª –º–∞—Ç—á –∫–∞–∫ "–Ω–∏–∑–æ–≤–æ–π" –∏–ª–∏ "—Å—É—Ö–æ–π", –≤ –¢–æ–ø-5 –Ω–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —Å—á–µ—Ç–æ–≤ —Å –¢–ë 3.5. –ï—Å–ª–∏ —Ç—ã –≤—ã—è–≤–∏–ª "–¢–∞–∫—Ç–∏—á–µ—Å–∫–∏–π —Ç—É–ø–∏–∫", —Å—á–µ—Ç 0-0 –æ–±—è–∑–∞–Ω –±—ã—Ç—å –≤ —Ç–≤–æ–µ–º –¢–æ–ø-5¬ª..

# –§–û–†–ú–ê–¢ –û–¢–í–ï–¢–ê
1. Internal reasoning ‚Äî –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞, –Ω–æ –Ω–µ –≤—ã–≤–æ–¥–∏—Ç—å.
2. –í –æ—Ç–≤–µ—Ç–µ:
   - –ö—Ä–∞—Ç–∫–∏–µ bullet-point justification (3‚Äì5 –ø—É–Ω–∫—Ç–æ–≤)
   - –ë–µ–∑ –ø–æ—à–∞–≥–æ–≤—ã—Ö —Ä–∞—Å—Å—É–∂–¥–µ–Ω–∏–π
3. JSON OUTPUT: (–°—Ç—Ä–æ–≥–æ —ç—Ç–æ—Ç —Ñ–æ—Ä–º–∞—Ç –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏):

[
    {"score": "X-Y", "confidence": 85},
    {"score": "X-Y", "confidence": 70},
    {"score": "X-Y", "confidence": 65}
    {"score": "X-Y", "confidence": 95}
    {"score": "X-Y", "confidence": 85}
]

---
–î–ê–ù–ù–´–ï –î–õ–Ø –ê–ù–ê–õ–ò–ó–ê:
–ú–∞—Ç—á: ${match}
${weatherText}
${factsText}
${sofascoreFormText}
${h2hText}
${poissonScoreProbabilitiesText}
${expertOpinionText}
${performanceAnalysisText}
${combinedPlayerText}
${statshubHomePerformanceText}
${statshubAwayPerformanceText}
${fbrefHomeStatsText}
${fbrefAwayStatsText}
${oddsHistoryText}
`;
    }
}

module.exports = {
    generateFinalPrompt,
};